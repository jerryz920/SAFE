{
  "name": "ContainerIsolation",
  "envs": {
    "OpenDns": "\"8.8.8.8\"",
    "RepoAddr": "ipv4\"192.168.1.2\"",
    "InnerNetwork": "ipv4\"192.168.0.0/24\""
  },
  "trustWallet": [
    "containerSpec(\"pidns\", \"default\")",
    "containerSpec(\"netns\", \"default\")",
    "containerSpec(\"mountns\", \"default\")",
    "containerSpec(\"utsns\", \"default\")",
    "containerSpec(\"ipcns\", \"default\")",
    "containerSpec(\"apparmor-profile\", \"default\")",
    "containerSpec(\"privileged\", \"false\")"
  ],
  "rules": [
    [
      "containerIsolated(Instance)",
      [
	"containerSpec(Name, Value)",
	"hasConfig(Instance, Name, RealValue)",
	"Value != RealValue"
      ],
      "\\+ (hasConfig(Instance, \"mount\", Path))",
      "I: controls(H, Instance)",
      "attester(H)",
      "trustedCloudProvider(I)",
      "launches(H, TapconImage)",
      "kernelBuildConfig(TapconImage, \"apparmor\", 1)",
      "kernelBuildConfig(TapconImage, \"selinux\", 1)",
      "kernelBuildConfig(TapconImage, \"seccomp\", 1)",
      "kernelBuildConfig(TapconImage, \"namespace\", 1)",
      "kernelBuildConfig(TapconImage, \"portext\", 1)"
    ]
  ],

  "comment-guards": "These are guard interfaces",
  "guards": {
    "ContainerIsolation": {
      "args": ["?Instance"],
      "exprs": [
	["?InstanceSet", ":=", "label(\"instance/?Instance\")"]
      ],
      "links": [
	"$InstanceSet"
      ],
      "queries": [
	"containerIsolated($Instance)"
      ]
    }
  }
}
